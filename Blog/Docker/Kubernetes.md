## Kubernetes
开源容器编排引擎

### 简介
管理跨多个主机的容器，提供基本的部署，维护以及应用伸缩
-   便携：支持公有云，私有云，混合云，以及多种云平台
-   可拓展：模块化，可插拔，支持钩子，可任意组合
-   自修复：自动重调度，自动重启，自动复制

### 基本概念

![](./image/Kubernetes1-1.png)

-  节点（`Node`）：一个节点是一个运行 Kubernetes 中的主机。
-  容器组（`Pod`）：一个 Pod 对应于由若干容器组成的一个容器组，同个组内的容器共享一个存储卷(volume)。
-  容器组生命周期（`pos-states`）：包含所有容器状态集合，包括容器组状态类型，容器组生命周期，事件，重启策略，以及 replication controllers。
-  Replication Controllers：主要负责指定数量的 pod 在同一时间一起运行。
-  服务（`services`）：一个 Kubernetes 服务是容器组逻辑的高级抽象，同时也对外提供访问容器组的策略。
-  卷（`volumes`）：一个卷就是一个目录，容器对其有访问权限。
-  标签（`labels`）：标签是用来连接一组对象的，比如容器组。标签可以被用来组织和选择子对象。
-  接口权限（`accessing_the_api`）：端口，IP 地址和代理的防火墙规则。
-  web 界面（`ux`）：用户可以通过 web 界面操作 Kubernetes。
-  命令行操作（`cli`）：`kubectl`命令。

#### 节点
在 `Kubernetes` 中，节点是实际工作的点，节点可以是虚拟机或者物理机器，依赖于一个集群环境。每个节点都有一些必要的服务以运行容器组，并且它们都可以通过主节点来管理。必要服务包括 Docker，kubelet 和代理服务。

##### 容器状态
容器状态用来描述节点的当前状态。现在，其中包含三个信息：
  - 主机IP: 主机 IP 需要云平台来查询，`Kubernetes` 把它作为状态的一部分来保存。如果 `Kubernetes` 没有运行在云平台上，节点 ID 就是必需的
  - 节点周期: 通常来说节点有 `Pending`，`Running`，`Terminated` 三个周期
  - 节点状态: 节点的状态主要是用来描述处于 `Running` 的节点。当前可用的有 `NodeReachable` 和 `NodeReady`

##### 节点管理
节点并非 Kubernetes 创建，而是由云平台创建，或者就是物理机器、虚拟机。在 Kubernetes 中，节点仅仅是一条记录，节点创建之后，Kubernetes 会检查其是否可用。在 Kubernetes 中，节点用如下结构保存：

```
{
  "id": "10.1.2.3",
  "kind": "Minion",
  "apiVersion": "v1beta1",
  "resources": {
    "capacity": {
      "cpu": 1000,
      "memory": 1073741824
    },
  },
  "labels": {
    "name": "my-first-k8s-node",
  },
}
```

Kubernetes 校验节点可用依赖于 ID。在当前的版本中，有两个接口可以用来管理节点：节点控制和 Kube 管理。

##### 节点控制
在 Kubernetes 主节点中，节点控制器是用来管理节点的组件。主要包含：
  -   集群范围内节点同步
  -   单节点生命周期管理
节点控制有一个同步轮寻，主要监听所有云平台的虚拟实例，会根据节点状态创建和删除。可以通过 `--node_sync_period`标志来控制该轮寻。如果一个实例已经创建，节点控制将会为其创建一个结构。同样的，如果一个节点被删除，节点控制也会删除该结构。在 Kubernetes 启动时可用通过 `--machines`标记来显示指定节点。同样可以使用 `kubectl` 来一条一条的添加节点，两者是相同的。通过设置 `--sync_nodes=false`标记来禁止集群之间的节点同步，你也可以使用 api/kubectl 命令行来增删节点。

#### 容器组
在 Kubernetes 中，使用的最小单位是容器组，容器组是创建，调度，管理的最小单位。 一个容器组使用相同的 Docker 容器并共享卷（挂载点）。一个容器组是一个特定应用的打包集合，包含一个或多个容器。

##### 资源共享和通信
容器组主要是为了数据共享和它们之间的通信。
在一个容器组中，容器都使用相同的网络地址和端口，可以通过本地网络来相互通信。每个容器组都有独立的 IP，可用通过网络来和其他物理主机或者容器通信。
容器组有一组存储卷（挂载点），主要是为了让容器在重启之后可以不丢失数据。

##### 容器组管理
容器组是一个应用管理和部署的高层次抽象，同时也是一组容器的接口。容器组是部署、水平放缩的最小单位。

##### 容器组的使用
容器组可以通过组合来构建复杂的应用，其本来的意义包含：
  -   内容管理，文件和数据加载以及本地缓存管理等。
  -   日志和检查点备份，压缩，快照等。
  -   监听数据变化，跟踪日志，日志和监控代理，消息发布等。
  -   代理，网桥
  -   控制器，管理，配置以及更新

##### 容器组的生命状态
包括若干状态值：`pending`、`running`、`succeeded`、`failed`

